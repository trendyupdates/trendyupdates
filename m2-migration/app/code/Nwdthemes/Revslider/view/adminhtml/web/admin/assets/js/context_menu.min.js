var tpLayerContextMenu=new function(){function e(e){var t=0,a=0;if(!e)var e=window.event;return e.pageX||e.pageY?(t=e.pageX,a=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:t,y:a}}function t(){a(),s(),l(),r()}function a(){document.addEventListener("contextmenu",function(e){b=w.clickInsideElement(e,"slide_layer"),jQuery(b).hasClass("demo_layer")||(b?(w.setLayerSelected(jQuery(b).data("serial")),e.preventDefault(),Q.toggleMenuOn("layer"),y(e)):(b=w.clickInsideElement(e,"bg_context_listener"))?(e.preventDefault(),Q.toggleMenuOn("background"),y(e)):(b=w.clickInsideElement(e,"ignorecontextmenu"))?(e.preventDefault(),Q.toggleMenuOn(),y(e)):(b=null,Q.toggleMenuOff()))})}function s(){jQuery("body").on("click",function(e){var t=w.clickInsideElement(e,C);t?(e.preventDefault(),_(t)):1===(e.which||e.button)&&Q.toggleMenuOff()})}function l(){window.onkeyup=function(e){27===e.keyCode&&Q.toggleMenuOff()}}function r(){window.onresize=function(e){Q.toggleMenuOff()}}function c(e){var t="rs-icon-layerimage_n";switch(e){case"image":t="rs-icon-layerimage_n";break;case"text":t="rs-icon-layerfont_n";break;case"button":t="rs-icon-layerbutton_n";break;case"audio":t="rs-icon-layeraudio_n";break;case"video":t="rs-icon-layervideo_n";break;case"svg":t="rs-icon-layersvg_n";break;case"row":t="rs-icon-layergroup_n";break;case"column":t="rs-icon-layercolumn_n";break;case"group":t="rs-icon-layergroup_n"}return t}function n(e,t){e?jQuery(t).removeClass("ctx-td-s-off"):jQuery(t).addClass("ctx-td-s-off")}function o(){jQuery(".not_in_ctx_bg").hide(),jQuery(".not_in_ctx_layer").show();var e=jQuery("#ctx_list_of_layers");e.html("");for(i in w.arrLayers)if(w.arrLayers.hasOwnProperty(i)){var t=w.arrLayers[i],a=c(t.type);e.append('<li class="ctx-dyn-avl-list-item context-menu__item" data-serial="'+t.serial+'"><div class="ctx_item_inner"><div class="context-menu__link" data-serial="'+t.serial+'" data-action="selectonelayer"><i class="'+a+'"></i><span class="cx-layer-name">'+t.alias+"</span></div></div></li>")}}function d(){var e=w.getLayer(w.selectedLayerSerial),t=e.references.htmlLayer;jQuery(".not_in_ctx_bg").show(),jQuery(".not_in_ctx_layer").hide(),jQuery("#cx-selected-layer-name").html(e.alias),jQuery("#cx-selected-layer-icon").attr("class",c(e.type));var a=jQuery("#cx-selected-layer-visible"),s=jQuery("#cx-selected-layer-locked");L.isLayerVisible(t)?(a.find("i").attr("class","eg-icon-eye-off"),a.find(".cx-layer-name").html("Hide Layer")):(a.find("i").attr("class","eg-icon-eye"),a.find(".cx-layer-name").html("Show Layer")),L.isLayerLocked(t)?(s.find("i").attr("class","eg-icon-lock-open"),s.find(".cx-layer-name").html("Unlock Layer")):(s.find("i").attr("class","eg-icon-lock"),s.find(".cx-layer-name").html("Lock Layer"));var l=jQuery("#ctx_list_of_invisibles"),i=jQuery("#ctx_list_of_layers"),r=!0;l.find(".ctx-dyn-inv-list-item").remove(),i.html("");for(b in w.arrLayers)if(w.arrLayers.hasOwnProperty(b)){var o=c((t=w.arrLayers[b]).type),d=void 0!==t.references&&void 0!==t.references.htmlLayer?t.references.htmlLayer:void 0;if(void 0!==d&&d.hasClass("currently_not_visible")){var y=r?"ctx-m-top-divider":"";r=!1,l.append('<li class="ctx-dyn-inv-list-item '+y+' context-menu__item"><div class="ctx_item_inner"><div class="context-menu__link" data-serial="'+t.serial+'" data-action="showonelayer"><i class="eg-icon-eye"></i><span class="cx-layer-name">'+t.alias+"</span></div></div></li>")}i.append('<li class="ctx-dyn-avl-list-item context-menu__item" data-serial="'+t.serial+'"><div class="ctx_item_inner"><div class="context-menu__link" data-serial="'+t.serial+'" data-action="selectonelayer"><i class="'+o+'"></i><span class="cx-layer-name">'+t.alias+"</span></div></div></li>")}"grid"===e.basealign?(jQuery("#ctx_gridbased").addClass("selected"),jQuery("#ctx_slidebased").removeClass("selected")):(jQuery("#ctx_gridbased").removeClass("selected"),jQuery("#ctx_slidebased").addClass("selected")),n(e["resize-full"],"#ctx_autoresponsive"),n(e.resizeme,"#ctx_childrenresponsive"),n(e.responsive_offset,"#ctx_responsiveoffset"),n(e["visible-desktop"],"#ctx_showhideondesktop"),n(e["visible-notebook"],"#ctx_showhideonnotebook"),n(e["visible-tablet"],"#ctx_showhideontablet"),n(e["visible-mobile"],"#ctx_showhideonmobile"),n(e.autolinebreak,"#ctx_linebreak"),n(e.scaleProportional,"#ctx_keepaspect"),e.displaymode||"block"===e.display?(jQuery("#ctx_displayblock").addClass("selected"),jQuery("#ctx_displayinline").removeClass("selected")):(jQuery("#ctx_displayblock").removeClass("selected"),jQuery("#ctx_displayinline").addClass("selected")),jQuery("#ctx-list-of-layer-links").data("uniqueid",e.unique_id);for(var u=void 0!==e.groupLink?e.groupLink:0,_=jQuery("#ctx-layer-link-type-element-cs"),b=0;b<6;b++)_.removeClass("ctx-layer-link-type-"+b);_.addClass("ctx-layer-link-type-"+u),jQuery(f).data("current_layer",d);var h="column"===w.getObjLayerType(e.p_uid);switch(f.className="context-menu layer_type_"+e.type+" in_column_"+h,jQuery("#ctx-inheritdesktop").show(),jQuery("#ctx-inheritnotebook").show(),jQuery("#ctx-inherittablet").show(),jQuery("#ctx-inheritmobile").show(),w.getLayout()){case"desktop":jQuery("#ctx-inheritdesktop").hide();break;case"notebook":jQuery("#ctx-inheritnotebook").hide();break;case"tablet":jQuery("#ctx-inherittablet").hide();break;case"mobile":jQuery("#ctx-inheritmobile").hide()}}function y(t){h=e(t),m=h.x,p=h.y;var a=jQuery("#viewWrapper").offset(),s=jQuery("#divbgholder").offset(),l=jQuery(window).scrollTop();g=f.offsetWidth+4,x=f.offsetHeight+4,v=window.innerWidth;var i=l+(j=window.innerHeight),r=15+m-a.left,c=p-(a.top+25);h.x=m-s.left,h.y=p-s.top,r=r+250>v-a.left?v-(260+a.left):r,c=c+300+a.top>i?i-300-a.top:c,f.style.left=r+"px",f.style.top=c+"px",r>v-(a.left+500)?jQuery("#context-menu-first-ul").addClass("submenustoleft"):jQuery("#context-menu-first-ul").removeClass("submenustoleft"),c+300+a.top+200>i?jQuery("#context-menu-first-ul").addClass("submenustobottom"):jQuery("#context-menu-first-ul").removeClass("submenustobottom")}function u(e){return!jQuery(e).hasClass("ctx-td-s-off")}function _(e){var t,a=!0,s={},l=!1,i=!1;if("delegate"!==e.getAttribute("data-action")){switch(e.getAttribute("data-action")){case"delete":jQuery("#button_delete_layer").click();break;case"duplicate":jQuery("#button_duplicate_layer").click();break;case"showhide":jQuery("#layer-short-toolbar .quick-layer-view").click();break;case"lockunlock":jQuery("#layer-short-toolbar .quick-layer-lock").click();break;case"showalllayer":w.showAllLayers();break;case"showonlycurrent":w.hideAllLayers(w.selectedLayerSerial);break;case"showonelayer":var r=w.getLayer(jQuery(e).data("serial"));L.showLayer(r);break;case"selectonelayer":w.setLayerSelected(jQuery(e).data("serial"));break;case"autoresponsive":a=!1,s["resize-full"]=u(e),s["resize-full"]||(s.resizeme=!1,jQuery("#ctx_childrenresponsive").addClass("ctx-td-s-off")),l=!0;break;case"childrenresponsive":a=!1,s.resizeme=u(e),s.resizeme&&(s["resize-full"]=!0,jQuery("#ctx_autoresponsive").removeClass("ctx-td-s-off")),l=!0;break;case"responsiveoffset":a=!1,s.responsive_offset=u(e),l=!0;break;case"gridbased":a=!1,s.basealign="grid",l=!0;break;case"slidebased":a=!1,s.basealign="slide",l=!0;break;case"nothing":a=!1;break;case"linebreak":a=!1,jQuery("#layer_auto_line_break")[0].checked?jQuery("#layer_auto_line_break")[0].checked=!1:jQuery("#layer_auto_line_break")[0].checked=!0,w.clickOnAutoLineBreak();break;case"displayblock":a=!1,s.displaymode=!0,s.display="block",l=!0,t=jQuery(f).data("current_layer"),i=!0;break;case"displayinline":a=!1,s.displaymode=!1,s.display="inline-block",l=!0,t=jQuery(f).data("current_layer"),i=!0;break;case"advancedcss":jQuery("#advanced-css-layer").click();break;case"resetsize":jQuery("#reset-scale").click();break;case"aspectratio":a=!1,jQuery("#layer_proportional_scale")[0].checked?(jQuery("#layer_proportional_scale")[0].checked=!1,jQuery("#ctx_keepaspect").addClass("ctx-td-s-off")):(jQuery("#layer_proportional_scale")[0].checked=!0,jQuery("#ctx_keepaspect").removeClass("ctx-td-s-off")),s.scaleProportional=jQuery("#layer_proportional_scale")[0].checked,l=!0;break;case"copystyle":a=!1;c=w.getLayer(w.selectedLayerSerial);Q.stylecache=UniteAdminRev.duplicateObject(c),UniteAdminRev.showInfo({type:"success",content:"Layer Style Successfull Copied to Clipboard",hidedelay:3});break;case"pastestyle":a=!1;c=w.getLayer(w.selectedLayerSerial);!1===jQuery.isEmptyObject(Q.stylecache)?(s.deformation=Q.stylecache.deformation,s["deformation-hover"]=Q.stylecache["deformation-hover"],s.display=Q.stylecache.display,s.displaymode=Q.stylecache.displaymode,s.margin=Q.stylecache.margin,s.autolinebreak=Q.stylecache.autolinebreak,s.padding=Q.stylecache.padding,s.whitespace=Q.stylecache.whitespace,s.static_styles=Q.stylecache.static_styles,s["2d_rotation"]=Q.stylecache["2d_rotation"],s["image-size"]=Q.stylecache["image-size"],l=!0,t=c.references.htmlLayer,i=!0):UniteAdminRev.showInfo({type:"warning",content:"No Style saved to Clipboard",hidedelay:3});break;case"inheritfromdesktop":case"inheritfromnotebook":case"inheritfromtablet":case"inheritfrommobile":var c=w.getLayer(w.selectedLayerSerial),n=e.getAttribute("data-size");(s={}).static_styles={},s.static_styles.color={},s.static_styles["font-size"]={},s.static_styles["line-height"]={},s.static_styles["font-weight"]={},s.padding={},s.margin={},s.max_height={},s.max_width={},s.scaleX={},s.scaleY={},s["text-align"]={},s.vieo_width={},s.video_height={},s.whitespace={},s.static_styles=w.setVal(s.static_styles,"color",w.getVal(c.static_styles,"color",n),!1),s.static_styles=w.setVal(s.static_styles,"font-size",w.getVal(c.static_styles,"font-size",n),!1),s.static_styles=w.setVal(s.static_styles,"line-height",w.getVal(c.static_styles,"line-height",n),!1),s.static_styles=w.setVal(s.static_styles,"font-weight",w.getVal(c.static_styles,"font-weight",n),!1),s=w.setVal(s,"padding",w.getVal(c,"padding",n),!1),s=w.setVal(s,"margin",w.getVal(c,"margin",n),!1),s=w.setVal(s,"max_height",w.getVal(c,"max_height",n),!1),s=w.setVal(s,"max_width",w.getVal(c,"max_width",n),!1),s=w.setVal(s,"scaleX",w.getVal(c,"scaleX",n),!1),s=w.setVal(s,"scaleY",w.getVal(c,"scaleY",n),!1),s=w.setVal(s,"text-align",w.getVal(c,"text-align",n),!1),s=w.setVal(s,"vieo_width",w.getVal(c,"vieo_width",n),!1),s=w.setVal(s,"video_height",w.getVal(c,"video_height",n),!1),s=w.setVal(s,"whitespace",w.getVal(c,"whitespace",n),!1),l=!0,t=c.references.htmlLayer,i=!0;break;case"showhideondesktop":a=!1,s["visible-desktop"]=u(e),l=!0;break;case"showhideonnotebook":a=!1,s["visible-notebook"]=u(e),l=!0;break;case"showhideontablet":a=!1,s["visible-tablet"]=u(e),l=!0;break;case"showhideonmobile":a=!1,s["visible-mobile"]=u(e),l=!0;break;case"grouplinkchange":a=!1,s.groupLink=e.getAttribute("data-linktype");for(var o=(c=w.getLayer(w.selectedLayerSerial)).references.sorttable.layer.find(".layer-link-type-element-cs").first(),d=jQuery("#ctx-layer-link-type-element-cs"),y=0;y<6;y++)o.removeClass("layer-link-type-"+y),d.removeClass("ctx-layer-link-type-"+y);o.addClass("layer-link-type-"+s.groupLink),d.addClass("ctx-layer-link-type-"+s.groupLink);break;case"addtextlayer":w.nextNewLayerToPosition(h),jQuery("#button_add_layer").click();break;case"addimagelayer":w.nextNewLayerToPosition(h),jQuery("#button_add_layer_image").click();break;case"addaudiolayer":w.nextNewLayerToPosition(h),jQuery("#button_add_layer_audio").click();break;case"addvideolayer":w.nextNewLayerToPosition(h),jQuery("#button_add_layer_video").click();break;case"addbuttonlayer":w.nextNewLayerToPosition(h),jQuery("#button_add_layer_button").click();break;case"addshapelayer":w.nextNewLayerToPosition(h),jQuery("#button_add_layer_shape").click();break;case"addobjectlayer":w.nextNewLayerToPosition(h),jQuery("#button_add_layer_svg").click()}!1===jQuery.isEmptyObject(s)&&w.updateLayer(w.selectedLayerSerial,s),l&&w.updateLayerFormFields(w.selectedLayerSerial),i&&L.rebuildLayerIdle(t),a&&Q.toggleMenuOff()}else jQuery(document.getElementById(e.getAttribute("data-delegate"))).click()}var b,h,m,p,f,k,g,x,v,j,Q=this,w=new Object,L=new Object,C="context-menu__link",V=0;Q.stylecache={},Q.init=function(){w=UniteLayersRev,L=tpLayerTimelinesRev,f=document.querySelector("#context-menu"),k=f.querySelectorAll(".context-menu__item"),t(),jQuery(".context-submenu").perfectScrollbar({wheelPropagation:!1,suppressScrollX:!0}),jQuery(".context-submenu").each(function(){jQuery(this).on("mouseenter",function(){jQuery(this).perfectScrollbar("update")})}),jQuery("body").on("mouseenter",".ctx-dyn-avl-list-item",function(){jQuery(".layer_due_list_element_selected").removeClass("layer_due_list_element_selected"),jQuery("#slide_layer_"+jQuery(this).data("serial")).addClass("layer_due_list_element_selected")}),jQuery("body").on("mouseleave",".ctx-dyn-avl-list-item",function(){jQuery(".layer_due_list_element_selected").removeClass("layer_due_list_element_selected")}),jQuery("body").on("click",".ctx-td-switcher",function(){jQuery(this).toggleClass("ctx-td-s-off")}),jQuery("body").on("click",".ctx-td-option-selector",function(){var e=jQuery(this);e.parent().find(".selected").removeClass("selected"),e.addClass("selected")})},Q.toggleMenuOn=function(e){punchgs.TweenLite.fromTo(f,.2,{x:10,autoAlpha:0},{x:0,autoAlpha:1,display:"block",ease:punchgs.Power2.easeInOut,delay:.2}),1!==V&&(V=1),"layer"===e?-1!=w.selectedLayerSerial&&d():"background"===e&&o()},Q.toggleMenuOff=function(){0!==V&&(V=0,punchgs.TweenLite.to(f,.2,{y:25,autoAlpha:0}))}};